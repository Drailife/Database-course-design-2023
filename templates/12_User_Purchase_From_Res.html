{% extends "0_base.html" %}

{% block title %}
Purchase_From_Res
{% endblock %}

{% block block1%}

{% endblock %}

{% block body%}
<!-- å±•ç¤ºç”¨æˆ·ç‚¹å•ç•Œé¢ -->
<div id="purchase" style="text-align: center; display:none;">
    <h1 class="">
        ç‚¹å•ç•Œé¢
    </h1>
    <hr class="my-4">
    <button id="show_shopcurt" onclick="show_shop_curt()" class="btn btn-success"
        style="margin-bottom: 10px;">æ˜¾ç¤ºè´­ç‰©è½¦</button>
    <div style="text-align: left;padding-left: 20px;">
        {% for item in dataForPurchase %}
        <div class="card" style="width: 15rem; display: inline-block;">
            <img src="../static/img/2.jpg" class="card-img-top" alt="...">
            <div class="card-body">
                <div class="card-title" style="text-align: center;font-family: 'Times New Roman', Times, serif;">
                    <font style="font-size: large;color: rgb(24, 130, 138);">{{item[1]}}</font>
                    <font style="font-size:larger; color: rgb(255, 0, 0);margin-left: 20px;">
                        ï¿¥{{item[2]}} </font>
                    </p>
                </div>
                <div class="card-title" style="color:rgb(20, 20, 20); font-size: 15px; text-align: center;">
                    æ‰€å±é¤å…:&nbsp;{{item[0]}}&nbsp;&nbsp;&nbsp;&nbsp; ç±»åˆ«: &nbsp;{{item[3]}}
                </div>
                <div style="text-align: center;">
                    <p class="btn btn-outline-danger bt_purchase_" style="width: 160px;" data-res_name="{{item[0]}}"
                        data-food_name="{{item[1]}}" data-food_price="{{item[2]}}" data-food_kind="{{item[3]}}"
                        data-description="{{item[4]}}">
                        åŠ å…¥è´­ç‰©è½¦
                    </p>
                </div>
            </div>
        </div>
        {%endfor%}
    </div>
</div>

<!-- å±•ç¤ºè´­ç‰©è½¦ç•Œé¢ -->
<div id="my_shopping_cart" style="text-align: center; display: none;">
    <div class="" style="background-color: #e4e9f7;font-family: 'Times New Roman', Times, serif; margin-bottom: 20px;">
        <div class="container">
            <h1 class="display-4">Total_price</h1>
            <h1 class="total_price" style="color:red;">ï¿¥{{total_price}}</h1>
            <hr class="my-4">
            <button onclick="show_purchase()" class="btn btn-outline-info btn-lg" style="width: 160px;">å»ç‚¹é¤</button>
            <a id="shopcart_cls" class="btn btn-outline-danger btn-lg" style="width: 160px;">æ¸…ç©ºè´­ç‰©è½¦</a>
            <a id="shopcart_purchase" class="btn btn-outline-primary btn-lg" style="width: 160px;">ä¸‹å•</a>
        </div>
    </div>
    <table class="table">
        <thead class="thead-light">
            <tr>
                <th scope="col">é¤å…åç§°</th>
                <th scope="col">é£Ÿç‰©åç§°</th>
                <th scope="col">è´­ä¹°æ•°é‡</th>
                <th scope="col">æ€»ä»·æ ¼</th>
                <th scope="col">æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {% for items in shopping_cart_info%}
            <tr>
                {% for item in items%}
                <td>{{item}}</td>
                {% endfor %}
                <td>
                    <button class="btn btn-success btn_sub_food" style="font-size: large; width: 50px;"> å‡1
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

<!-- å±•ç¤ºæˆ‘çš„è®¢å•ç•Œé¢ -->
<div id="my_orders" style="text-align: center; display: none;">
    <h1>
        æˆ‘çš„è®¢å•
    </h1>
    <hr class="my-4">
    <table class="table">
        <thead class="thead-light">
            <tr>
                <th scope="col">è®¢å•ç¼–å·</th>
                <th scope="col">æ€»ä»·æ ¼</th>
                <th scope="col">å®é™…èŠ±è´¹</th>
                <th scope="col">ä¸‹å•æ—¶é—´</th>
                <th scope="col">æ“ä½œ</th>
            </tr>
        </thead>
        <tbody>
            {%for items in data_orders%}
            <tr>
                {% for item in items%}
                <td> {{item}}</td>
                {%endfor%}
                <td><a class="btn btn-danger" data-type="orders" data-id="{{items[0]}}">Delete</a></td>
            </tr>
            {%endfor%}
        </tbody>
    </table>
</div>

<!-- å±•ç¤ºè®¢å•ç»†åˆ™ç•Œé¢ -->
<div id="my_orders_details" style="text-align: center; display: none;">
    <h1>
        è®¢å•ç»†åˆ™
    </h1>
    <hr class="my-4">
    <table class="table">
        <thead class="thead-light">
            <tr>
                <th scope="col">ç”¨æˆ·å</th>
                <th scope="col">è®¢å•ç¼–å·</th>
                <th scope="col">é¤å…åç§°</th>
                <th scope="col">é£Ÿç‰©åç§°</th>
                <th scope="col">æ•°é‡</th>
                <th scope="col">ä¸‹å•æ—¶é—´</th>
            </tr>
        </thead>
        <tbody>
            {%for items in data_orders_detail%}
            <tr>
                {% for item in items%}
                <td> {{item}}</td>
                {%endfor%}

            </tr>
            {%endfor%}
        </tbody>
    </table>
</div>

<!-- å±•ç¤ºç”¨æˆ·ä¿¡æ¯ç•Œé¢-->

<div id="my_user_infos" style="text-align: left;display: none;">
    <div class="modal-dialog">
        <div class="modal-content" style="width: 600px;border: none;background-color: #e4e9f7;">
            <div class="modal-header" style="text-align:center;">
                <h3 class="modal-title" id="staticBackdropLabel">ä¸ªäººä¿¡æ¯</h3>
            </div>
            <div class="modal-body">
                <form autocomplete="off" id="userinfoform" method="post">
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="inputId">Usr_id</label>
                            <input type="text" class="form-control" id="usrid" name="usr_id" value='{{user_infos[0]}}'
                                readonly>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="inputName">Name</label>
                            <input type="text" class="form-control form-control_" name="usr_name"
                                value="{{user_infos[1]}}" required readonly>
                        </div>

                        <div class="form-group col-md-6">
                            <label for="inputSex">Sex</label>
                            <select class="form-control form-control_ custom-select mr-sm-2" id="Inpusex" name="sex"
                                required disabled>
                                <option selected value="{{user_infos[3]}}">{{user_infos[3]}}</option>
                                <option value="ç”·">ç”·ğŸ‘¦</option>
                                <option value="å¥³">å¥³ğŸ‘§</option>
                            </select>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="inputAge">Age</label>
                            <input type="number" class="form-control form-control_" value="{{user_infos[4]}}" id="age"
                                name="age" required readonly>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group col-md-6">
                            <label for="inputEmail">Email</label>
                            <input type="mail" class="form-control form-control_" id="inputEmail" name="mail"
                                value="{{user_infos[2]}}" placeholder="xxx@xx.com" required readonly>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="Password4">Password</label>
                            <input type="text" class="form-control form-control_" id="Password4" name="password_"
                                value="{{user_infos[7]}}" required readonly>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="inputAddress">Address</label>
                        <input type="text" class="form-control form-control_" value="{{user_infos[6]}}"
                            id="inputAddress" name="address_" required readonly>
                    </div>
                    <div class="form-group">
                        <label for="inputTel">Telephone</label>
                        <input type="number" class="form-control form-control_" value="{{user_infos[5]}}" id="inputTel"
                            name="telephone" required readonly>
                    </div>
                    <div class="modal-footer">
                        <button type="button" id="quit" class="btn btn-outline-info submit_1"
                            style="display:none; width: 120px;">Quit
                            Edit</button>
                        <button type="button" id="edit_button" class="btn btn-outline-info submit_1"
                            style="width: 120px;">Edit</button>
                        <button type="button" id="edit_submit" class="btn btn-outline-primary submit_1"
                            style="display: none;width: 120px;">Submit</button>
                    </div>
                </form>
                <iframe id="rfFrame" name="rfFrame" src="about:blank" style="display:none;"></iframe>

            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block script %}
<script>
    function show_shop_curt() { window.location.replace('/user_operate/shopping_cart'); }
    function show_purchase() { window.location.replace('/user_operate/purchase'); }
    //è¿™ä¸€æ“ä½œä¿è¯ä¸€ä¸ªç•Œé¢åªæ˜¾ç¤ºä¸€ä¸ªèœå•
    var menu_id = "{{ menu_id }}";
    if (menu_id === '1') { $('#purchase').show(); $('#my_shopping_cart').hide(); $('#my_orders').hide(); $('#my_orders_details').hide(); $('#my_user_infos').hide() }
    else if (menu_id === '2') { $('#purchase').hide(); $('#my_shopping_cart').show(); $('#my_orders').hide(); $('#my_orders_details').hide(); $('#my_user_infos').hide() }
    else if (menu_id === '3') { $('#purchase').hide(); $('#my_shopping_cart').hide(); $('#my_orders').show(); $('#my_orders_details').hide(); $('#my_user_infos').hide() }
    else if (menu_id === '4') { $('#purchase').hide(); $('#my_shopping_cart').hide(); $('#my_orders').hide(); $('#my_orders_details').show(); $('#my_user_infos').hide() }
    else { $('#purchase').hide(); $('#my_shopping_cart').hide(); $('#my_orders').hide(); $('#my_orders_details').hide(); $('#my_user_infos').show() }
    $(document).ready(function () {
        $(".bt_purchase_").click(function () {
            var value = $(this)
            columnData = [value.data('res_name'), value.data('food_name'), value.data('food_price'),
            value.data('food_kind'), value.data('description')]
            keys = ['res_name', 'food_name', 'price', 'kind', 'description_'];
            // åˆ›å»ºå­—å…¸
            const result = keys.reduce((obj, key, index) => {
                obj[key] = columnData[index];
                return obj;
            }, {});
            $.post("/user_operate/add_to_shopcart", result, function (data) { alert(data); }); //å‘é€æ•°æ®
        });
        //è´­ç‰©è½¦ç•Œé¢å‡å°‘å•†å“
        $(".btn_sub_food").click(function () {
            var tr = $(this).closest('tr'); //æŸ¥æ‰¾æœ€è¿‘çš„trå…ƒç´ 
            var tds = tr.find('td:not(:last-child)'); //æŸ¥æ‰¾é™¤äº†æœ€åä¸€ä¸ªtdå…ƒç´ ä»¥å¤–çš„æ‰€æœ‰tdå…ƒç´ 
            var columnData = [];
            tds.each(function () {
                columnData.push($(this).text()); //è·å–æ¯ä¸ªtdå…ƒç´ çš„æ–‡æœ¬å†…å®¹
            });
            var jsonData = JSON.stringify({ "datas": columnData });
            keys = ['res_name', 'food_name', 'num', 'total_price'];
            // åˆ›å»ºå­—å…¸
            const result = keys.reduce((obj, key, index) => {
                obj[key] = columnData[index];
                return obj;
            }, {});
            console.log(result);
            $.post("/user_operate/sub_from_shopcart", result, function (data) {
                $('.total_price').val = data;
                window.location.reload();
            }); //å‘é€æ•°æ®
        });
        //è´­ç‰©è½¦æ¸…ç©º
        $("#shopcart_cls").click(function () {
            $.post("/user_operate/shopcurt/cls", null, function (data) { window.location.reload(); })
        });
        $("#shopcart_purchase").click(function () {
            $.post("/user_operate/shopcurt/purchase",
                { 'total_price': "{{total_price}}" },
                function (data) { alert(data); if (data === 'ä¸‹å•æˆåŠŸ!') window.location.reload(); })
        });
        //ç¼–è¾‘ä¸ªäººä¿¡æ¯
        $('#edit_button').click(function () {
            $('#quit').show();
            $('#edit_button').hide()
            $('#edit_submit').show();
            $('.form-control_').removeAttr('readonly').removeAttr('disabled');
        })
        $('#quit').click(function () {
            $('#quit').hide();
            $('#edit_button').show()
            $('#edit_submit').hide();
            $('.form-control_').prop('readonly', true).prop('disabled', true);
            window.location.reload();
        })
        $('#edit_submit').click(function () {
            $('#quit').hide();
            $('#edit_button').show()
            $('#edit_submit').hide();
            var formdatas = $('#userinfoform').serialize()
            $.post('/user_operate/edit_user', formdatas, function (data) {
                alert(data);
                $('.form-control_').prop('readonly', true).prop('disabled', true);
                window.location.reload();
            })
        })
    });


</script>
{% endblock %}